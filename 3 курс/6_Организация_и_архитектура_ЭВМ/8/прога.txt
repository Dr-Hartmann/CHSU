; 13 вариант
; R0      -- ASCII код числа
; R1      -- тек. ячейка записи числа в ОЗУ
; R2      -- буфер дес. числа
; R3      -- рез. деления на 2
; R4      -- остаток от деления
; R5      -- тек. десятичное число
; R6      -- тек. двоичный код
; R7      -- число умножений на 10
; R8      -- тек. разр. всего числа
; R9      -- текущий разряд цифры (счётчик)

RD #94
WR R1

INIT:        ; обнуление (инициализация)
RD #101 ; очистка буффера
OUT 1
RD #10  ; установить флаг Е в регистре CR
OUT 1    ; для ввода без прерываний
RD #103
OUT 1    ;  режим посимвольного ввода

RD #4
WR R8
RD R1
ADD R9
ADD #6
WR R1

M1:  IN 2   ; проверка флага Rdy
JZ M1        ; ожидание Rdy  = 1;
IN 0           ; считывание введённого
WR R0      ; символа

RD #4
WR R9     ; счётчик
RD #0
WR R6

RD R0       ; проверка цифры
SUB #48
JS PREINIT
WR R5     ; число
SUB #10
JNS PREINIT

RD R5   ; тек. десятичное число
WR R2  ; буфер дес. числа

LOOP: RD R2
DIV #2
WR R3
RD R2
SUB R3
SUB R3
WR R4  ; остаток от деления
RD R2
DIV #2
WR R2 ; модификация буфера

RD #3
SUB R9 ; счётчик
JS MULEND
WR R7  ; число умножений на 10
MULT: RD R4
MUL #10
WR R4
RD R7
SUB #1
WR R7
JNS MULT

MULEND: RD R6
ADD R4
WR R6

RD R9
SUB #1
WR R9
JNS LOOP

RD R6
WR @R1+ ; запись в ОЗУ
RD R8      ; проверка перехода
SUB #1    ; к записи нового числа
JS INIT
WR R8     ; тек. разр. числа
JMP M1

END: OUT
HLT     ; конец программы

PREINIT:
RD R9
SUB #1
WR R9
JMP INIT

F: NOP ; имитация работы
NOP
JMP F
